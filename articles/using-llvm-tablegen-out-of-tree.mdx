---
author: Mats Larsen
date: 1630874485
title: Using LLVM TableGen out-of-tree
brief: |
  So you're interested in using TableGen in your own project, but you don't know
  how to set up TableGen outside of LLVM?
imageUrl: /images/llvm.png
imageAlt: The LLVM logo
topics:
  - llvm
  - tablegen
public: false
---

## What is TableGen?

TableGen is LLVMs powerful domain-specific language used to maintain records of
domain-specific information. It's used to keep track of large amounts of
information which may be referred in source code. Clang uses it to keep track of
its thousands of diagnostic messages, and the LLVM backends use it to describe
register and instruction info.

TableGen declaration files are a set of class definitions and records which
are transformed by a TableGen backend. Backends are C++ functions which
transform a set of TableGen records into the desired format. Because TableGen
is used to generate domain-specific information, there is usually a
domain-specific TableGen backend involved. In the case of Clang diagnostic
messages, the `gen-clang-diag-defs` backend is used.

## Using TableGen out-of-tree

The `llvm-tblgen` executable which is distributed is stuck with LLVMs built-in
backends, and is far from useful for clients which want to use TableGen in their
own projects. This means we're going to have to create our own TableGen tool and
our own backends. Luckily for us is TableGen "just another LLVM component" which
makes it easy to extend and tweak it to our liking.

Assuming we have an LLVM distribution available on our system, we can get
started in under 30 lines of code.

```cmake
project(tablegen_out_of_tree)
cmake_minimum_required(VERSION 3.10)

find_package(LLVM 12 REQUIRED CONFIG)
llvm_map_components_to_libnames(LLVMLibs TableGen Support)

add_executable(tblgen main.cpp)
target_include_directories(tblgen PRIVATE ${LLVM_INCLUDE_DIRS})
target_link_libraries(tblgen PRIVATE ${LLVMLibs})
```

I am using LLVM 12, but earlier versions should also function as expected. We
need to grab the CMake configuration which is distributed with LLVM to access
the helper macro `llvm_map_components_to_libnames`. We're going to use two
components; TableGen and Support.

We'll only need one C++ file, which is going to be our TableGen executable. The
code listing is as follows:

```cpp
#include "llvm/TableGen/Main.h"
#include "llvm/Support/CommandLine.h"
#include "llvm/Support/InitLLVM.h"
#include "llvm/TableGen/Record.h"

namespace {
bool TableGenMain(llvm::raw_ostream &OS, llvm::RecordKeeper &Records) {
  return true;
}
} // end namespace

int main(int argc, char **argv) {
  llvm::InitLLVM X(argc, argv);
  llvm::cl::ParseCommandLineOptions(argc, argv);
  return llvm::TableGenMain(argv[0], &TableGenMain);
}
```